# ******************************************************************
# NEO4J 2026 OPTIMIZED CONFIGURATION (256GB RAM / NVMe SSD)
# ******************************************************************

# --- PATHS ---
# Pointing to our mounted Local NVMe SSD
server.directories.data=/var/lib/neo4j/data
server.directories.plugins=/var/lib/neo4j/plugins
server.directories.logs=/var/log/neo4j

# --- NETWORK ---
server.default_advertised_address=0.0.0.0
server.bolt.enabled=true
server.bolt.listen_address=:7687
server.http.enabled=true
server.http.listen_address=:7474

# --- MEMORY MANAGEMENT ---
# Total VM RAM: 256GB
# Heap: Keep at 31G to utilize Compressed OOPs (crucial for performance)
server.memory.heap.initial_size=31G
server.memory.heap.max_size=31G

# Page Cache: 120GB (Large enough to fit massive graph structures for fast random access)
server.memory.pagecache.size=120G

# Note: The remaining ~100GB is left for OS overhead and, most importantly,
# GDS's off-heap native memory allocations.
server.memory.pagecache.warmup.enable=true

# --- GDS & APOC SECURITY ---
dbms.security.procedures.unrestricted=gds.*,apoc.*
dbms.security.procedures.allowlist=gds.*,apoc.*

# --- GDS ENTERPRISE ---
gds.enterprise.license_file=/etc/neo4j/gds.license

# --- STORAGE TUNING (Optimized for NVMe) ---
# High-speed SSDs handle concurrent IO better; increase parallel indexing
server.databases.default_to_read_only=false
dbms.index_sampling.background_count=4

# Transaction log rotation (NVMe is fast, so we can keep logs tidy)
db.tx_log.rotation.retention_policy=1 days
db.tx_log.rotation.size=256M

# --- JVM ADDITIONAL ---
# Optimized G1 Garbage Collector for high-memory heaps
server.jvm.additional=-XX:+UseG1GC
server.jvm.additional=-XX:MaxGCPauseMillis=200
server.jvm.additional=-XX:+ParallelRefProcEnabled
server.jvm.additional=-XX:+UnlockDiagnosticVMOptions
server.jvm.additional=-XX:+DebugNonSafepoints

# --- GDS ARROW CONFIGURATION ---
# Enable the high-speed Arrow Flight server
gds.arrow.enabled=true

# Listen on all interfaces so the GPU box can connect via the VPC
gds.arrow.listen_address=0.0.0.0:8491
